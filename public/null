$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1)->result();
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1)->result();
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1)->result();
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1)->result();
  $q->selectRaw('avg(score) as average_score');
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
  $q->selectRaw('avg(score) as average_score');
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
  $q->selectRaw('avg(score) as average_score');
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
  $q->selectRaw('avg(score) as average_score')->groupBy('student_id');
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
  
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.avgScore'])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1);
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
  $q->where('student_id', 1)->result();
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.avgScore'])->find(1);
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);

TeacherSubject::avgScore()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()

TeacherSubject::avgScore()->get()
$s = Student::with('studentGrade.teacherSubject.avgScore')->find(1);

$s = Student::with('studentGrade.teacherSubject',function($q){
$q->avgScore();
})->find(1);

$s = Student::with(['studentGrade.teacherSubject',function($q){
$q->avgScore();
}])->find(1);

$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);

$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->avgScore();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->studentCompetency();
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->with('studentCompetency');
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->with(['studentCompetency' => function($s){
  		$s->where('student_id',1);
	}]);
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject' => function($q){
$q->with(['studentCompetency' => function($s){
  		$s->select('score');
	}]);
}])->find(1);


$teacherSubject = TeacherSubject::with('studentCompetency')->find(1);
$averageScore = $teacherSubject->studentCompetency->avg('avg_score');
$teacherSubject = TeacherSubject::with('studentCompetency')->find(1);

$teacherSubject = TeacherSubject::with('studentCompetency')->find(1);
$averageScore = $teacherSubject->studentCompetency->avg('score');
$teacherSubject = TeacherSubject::with('studentCompetency')->find(1);

$s = Student::with(['studentGrade.teacherSubject.studentCompetencies' => function($q){
$q->avg('score');
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->avg('score');
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);


$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);

$s->studentGrade->teacherSubject->studentCompetency
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);

$s->studentGrade->teacherSubject
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);

$s->studentGrade->teacherSubject->studentCompetency
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1)->map(function ($teacherSubject) {
    return $teacherSubject->studentCompetency->avg('avg_score');
});;
$averageScore = TeacherSubject::whereHas('studentCompetency', function ($query) {
    $query->where('student_id', 2);
})
->with(['studentCompetency' => function ($query) {
    $query->selectRaw('AVG(score) as avg_score')
          ->where('student_id', 2);
}])
->get()
->map(function ($teacherSubject) {
    return $teacherSubject->studentCompetency->avg('avg_score');
});
$averageScore = TeacherSubject::whereHas('studentCompetency', function ($query) {
    $query->where('student_id', 1);
})
->with(['studentCompetency' => function ($query) {
    $query->selectRaw('AVG(score) as avg_score')
          ->where('student_id', 1);
}])
->get()
->map(function ($teacherSubject) {
    return $teacherSubject->studentCompetency->avg('avg_score');
});
$averageScore = TeacherSubject::whereHas('studentCompetency', function ($query) {
    $query->where('student_id', 1);
})
->with(['studentCompetency' => function ($query) {
    $query->selectRaw('AVG(score) as avg_score')
          ->where('student_id', 1);
}])
->get()
->map(function ($teacherSubject) {
    return $teacherSubject->studentCompetency->avg('avg_score');
});
$averageScore = TeacherSubject::whereHas('studentCompetency', function ($query) {
    $query->where('student_id', 1);
})
->with(['studentCompetency' => function ($query) {
    $query->selectRaw('AVG(score) as avg_score')
          ->where('student_id', 1);
}])
->get()
->map(function ($teacherSubject) {
    return $teacherSubject->studentCompetency->avg('avg_score');
});
$s = Student::with(['studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.subject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);
$s = Student::with(['studentGrade.teacherSubject.subject','studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);
$s = Student::with([
 'studentGrade.grade',
'studentGrade.teacherSubject.subject',
'studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1);
}])->find(1);
$s = Student::with([
'studentGrade.grade',
'studentGrade.teacherSubject.subject',
'studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1)->result();
}])->find(1);
$s = Student::with([
'studentGrade.grade',
'studentGrade.teacherSubject.subject',
'studentGrade.teacherSubject.studentCompetency' => function($q){
$q->where('student_id',1)->result();
}])->find(1);

$s->toArray()
$student = Student::with([
        'studentGrade.grade',
        'studentGrade.teacherSubject.subject',
        ])->find(1);

$competencies
$student = Student::with([
        'studentGrade.grade',
        'studentGrade.teacherSubject.subject',
        ])->find(1);
$student = Student::with([
        'studentGrade.grade',
        'studentGrade.teacherSubject.subject',
        ])->find(1);

$student->studentGrade->teacherSubject->push(['tes']);
$student = Student::with([
        'studentGrade.grade',
        'studentGrade.teacherSubject.subject',
        ])->find(1);

$student->studentGrade->teacherSubject->push(['tes tes']);
$student = Student::with([
        'studentGrade.grade',
        'studentGrade.teacherSubject.subject',
        ])->find(1);

$student->studentGrade->teacherSubject->push(['tes tes']);

$student
